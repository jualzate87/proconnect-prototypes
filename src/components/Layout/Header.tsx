import React, { useState, useRef, useEffect } from 'react';
import { IconHelp, IconNotification, IconUser } from '../ProConnectLibrary';
import './Header.css';

interface HeaderProps {
  onOpenTrowser?: (trowser: 'api-portal' | 'firm-branding') => void;
}

export const Header: React.FC<HeaderProps> = ({ onOpenTrowser }) => {
  const [showSettingsMenu, setShowSettingsMenu] = useState(false);
  const menuRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {
        setShowSettingsMenu(false);
      }
    };

    if (showSettingsMenu) {
      document.addEventListener('mousedown', handleClickOutside);
    }

    return () => {
      document.removeEventListener('mousedown', handleClickOutside);
    };
  }, [showSettingsMenu]);

  return (
    <header className="header">
      <div className="header-left">
        <div className="header-account">ProConnect Tax Testing account</div>
      </div>
      <div className="header-right">
        <button className="header-icon-btn" aria-label="Help">
          <IconHelp size={20} />
        </button>
        <button className="header-icon-btn" aria-label="Notifications">
          <IconNotification size={20} />
        </button>
        <div className="header-settings-container" ref={menuRef}>
          <button 
            className="header-icon-btn" 
            aria-label="Settings"
            onClick={() => setShowSettingsMenu(!showSettingsMenu)}
          >
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M10.0201 6.65218H10.0143C9.13023 6.65218 8.28238 7.00337 7.65726 7.62849C7.03214 8.25361 6.68095 9.10146 6.68095 9.98551C6.68095 10.8696 7.03214 11.7174 7.65726 12.3425C8.28238 12.9677 9.13023 13.3188 10.0143 13.3188C10.8983 13.3196 11.7465 12.9692 12.3722 12.3446C12.9978 11.72 13.3498 10.8725 13.3505 9.98843C13.3513 9.10438 13.0009 8.25622 12.3763 7.63055C11.7517 7.00489 10.9042 6.65295 10.0201 6.65218ZM10.0151 11.6522C9.68547 11.6518 9.36335 11.5536 9.08949 11.3702C8.81562 11.1867 8.60232 10.9261 8.47655 10.6214C8.35078 10.3167 8.31819 9.98155 8.3829 9.65832C8.44762 9.33509 8.60673 9.03831 8.84012 8.80551C8.99429 8.65057 9.17768 8.52777 9.37966 8.44423C9.58165 8.36069 9.79821 8.31807 10.0168 8.31885C10.4588 8.31885 10.8827 8.49444 11.1953 8.807C11.5079 9.11956 11.6834 9.54349 11.6834 9.98551C11.6834 10.4275 11.5079 10.8515 11.1953 11.164C10.8827 11.4766 10.4588 11.6522 10.0168 11.6522H10.0151Z" fill="#5D686F"/>
              <path d="M17.0368 11.1671L16.6126 10.9213C16.7031 10.3096 16.7031 9.68792 16.6126 9.07625L17.0384 8.83208C17.421 8.61069 17.7003 8.24671 17.8151 7.81985C17.9299 7.39298 17.8709 6.93802 17.6509 6.55458L16.8176 5.11042C16.5965 4.72799 16.2329 4.44868 15.8064 4.33359C15.38 4.21849 14.9252 4.27698 14.5418 4.49625L14.1151 4.74208C13.6283 4.36107 13.0913 4.04897 12.5193 3.81458V3.32292C12.5193 2.88089 12.3437 2.45697 12.0311 2.14441C11.7185 1.83184 11.2946 1.65625 10.8526 1.65625H9.18593C8.7439 1.65625 8.31998 1.83184 8.00742 2.14441C7.69486 2.45697 7.51926 2.88089 7.51926 3.32292V3.82292C6.94874 4.05366 6.41283 4.36213 5.92676 4.73958L5.49426 4.48958C5.11383 4.26883 4.66156 4.20741 4.23603 4.31871C3.8105 4.43 3.44622 4.705 3.22259 5.08375L2.38926 6.52542C2.16772 6.90789 2.10717 7.3627 2.22094 7.7898C2.33471 8.21691 2.61348 8.58134 2.99593 8.80292L3.42009 9.04875C3.37497 9.35448 3.35186 9.66305 3.35093 9.97208C3.35098 10.2821 3.37298 10.5918 3.41676 10.8988L2.99259 11.1429C2.60949 11.363 2.32943 11.7261 2.21395 12.1525C2.09847 12.579 2.15703 13.0338 2.37676 13.4171L3.21009 14.8613C3.31919 15.051 3.46459 15.2175 3.63801 15.351C3.81143 15.4846 4.00946 15.5827 4.2208 15.6397C4.43213 15.6968 4.65263 15.7116 4.86971 15.6834C5.08678 15.6552 5.29617 15.5845 5.48593 15.4754L5.91259 15.2296C6.39934 15.6109 6.93634 15.9233 7.50843 16.1579V16.6463C7.50843 17.0883 7.68402 17.5122 7.99658 17.8248C8.30914 18.1373 8.73307 18.3129 9.1751 18.3129H10.8418C11.2838 18.3129 11.7077 18.1373 12.0203 17.8248C12.3328 17.5122 12.5084 17.0883 12.5084 16.6463V16.1671C13.0813 15.935 13.6192 15.6245 14.1068 15.2446L14.5326 15.4946C14.9151 15.7161 15.3699 15.7767 15.797 15.6629C16.2241 15.5491 16.5885 15.2704 16.8101 14.8879L17.6434 13.4463C17.7534 13.2568 17.8249 13.0475 17.8539 12.8304C17.883 12.6133 17.8689 12.3926 17.8126 12.1809C17.7562 11.9692 17.6587 11.7707 17.5256 11.5968C17.3925 11.4228 17.2264 11.1768 17.0368 11.1671ZM14.8759 8.83375C15.0636 9.59429 15.0636 10.389 14.8759 11.1496C14.8338 11.3244 14.8494 11.5081 14.9203 11.6733C14.9912 11.8385 15.1136 11.9763 15.2693 12.0663L16.2043 12.6096L15.3709 14.0504L14.4351 13.5087C14.2798 13.4189 14.0997 13.3815 13.9214 13.4022C13.7432 13.423 13.5765 13.5007 13.4459 13.6238C12.8782 14.1594 12.1934 14.5551 11.4459 14.7796C11.2739 14.8306 11.1228 14.9357 11.0153 15.0794C10.9078 15.2231 10.8496 15.3976 10.8493 15.5771V16.6554H9.1826V15.5779C9.18297 15.3984 9.12533 15.2235 9.01826 15.0793C8.9112 14.9352 8.76044 14.8295 8.58843 14.7779C7.83995 14.5523 7.15491 14.1541 6.58843 13.6154C6.45782 13.4923 6.29114 13.4144 6.11293 13.3931C5.93472 13.3718 5.75437 13.4082 5.59843 13.4971L4.66093 14.0371L3.82759 12.5929L4.76509 12.0538C4.92122 11.9642 5.04415 11.8265 5.1155 11.6613C5.18685 11.496 5.20279 11.3121 5.16093 11.1371C5.06927 10.7586 5.02256 10.3707 5.02176 9.98125C5.02428 9.59148 5.0721 9.20331 5.16426 8.82458C5.20635 8.64981 5.19078 8.46611 5.11989 8.3009C5.04901 8.13569 4.92659 7.99784 4.77093 7.90792L3.83509 7.36625L4.66843 5.92375L5.60509 6.46708C5.62093 6.47625 5.63926 6.47542 5.65509 6.48375C5.70485 6.50644 5.75679 6.52403 5.81009 6.53625C5.86424 6.55336 5.92015 6.56426 5.97676 6.56875C5.99343 6.56875 6.00926 6.57875 6.02593 6.57875C6.06411 6.57423 6.10197 6.56727 6.13926 6.55792C6.18718 6.55322 6.23458 6.5443 6.28093 6.53125C6.32833 6.51129 6.3738 6.48702 6.41676 6.45875C6.4629 6.43516 6.50671 6.40725 6.54759 6.37542C6.56009 6.36458 6.57593 6.36125 6.58759 6.34958C7.15494 5.81315 7.83983 5.41677 8.58759 5.19208C8.60163 5.18569 8.61527 5.17846 8.62843 5.17042C8.68219 5.14837 8.73334 5.12042 8.78093 5.08708C8.82535 5.06368 8.86724 5.03576 8.90593 5.00375C8.9438 4.96639 8.97785 4.92536 9.0076 4.88125C9.03928 4.84055 9.06718 4.79704 9.09093 4.75125C9.11044 4.70464 9.12578 4.6564 9.13676 4.60708C9.15374 4.55282 9.16519 4.49698 9.17093 4.44042C9.17093 4.42542 9.18009 4.41208 9.18009 4.39625V3.31792H10.8468V4.39625C10.8464 4.57581 10.904 4.75069 11.0111 4.89485C11.1182 5.039 11.2689 5.14472 11.4409 5.19625C12.1888 5.42319 12.8736 5.8212 13.4409 6.35875C13.5711 6.48206 13.7376 6.56009 13.9156 6.58126C14.0937 6.60242 14.2738 6.5656 14.4293 6.47625L15.3676 5.93708L16.2009 7.38125L15.2634 7.92042C15.1095 8.01102 14.9887 8.14869 14.9189 8.31313C14.8492 8.47758 14.8341 8.66009 14.8759 8.83375Z" fill="#5D686F"/>
            </svg>
          </button>
          
          {showSettingsMenu && (
            <div className="settings-dropdown">
              <div className="settings-dropdown-section">
                <div className="settings-dropdown-label">SETTINGS</div>
                <button className="settings-dropdown-item">Client letters</button>
                <button 
                  className="settings-dropdown-item"
                  onClick={() => {
                    setShowSettingsMenu(false);
                    onOpenTrowser?.('firm-branding');
                  }}
                >
                  Firm branding
                  <span className="settings-dropdown-badge">NEW</span>
                </button>
                <button className="settings-dropdown-item">Print settings</button>
                <button className="settings-dropdown-item">Task accelerators</button>
              </div>
              
              <div className="settings-dropdown-section">
                <div className="settings-dropdown-label">OTHER TOOLS</div>
                <button 
                  className="settings-dropdown-item settings-dropdown-item-highlight"
                  onClick={() => {
                    setShowSettingsMenu(false);
                    onOpenTrowser?.('api-portal');
                  }}
                >
                  API portal
                  <span className="settings-dropdown-badge">NEW</span>
                </button>
                <button className="settings-dropdown-item">Batch actions</button>
                <button className="settings-dropdown-item">SmartLook</button>
              </div>
            </div>
          )}
        </div>
        <button className="header-icon-btn header-avatar" aria-label="Account">
          <IconUser size={24} />
        </button>
      </div>
    </header>
  );
};
